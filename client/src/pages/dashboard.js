import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Users, MessageSquare, DollarSign, TrendingUp, Brain, Target } from "lucide-react";
export default function Dashboard() {
    const { data: villageState } = useQuery({
        queryKey: ['/api/village-state'],
        retry: 1,
        staleTime: 30000
    });
    const { data: forumSentimentAnalysis } = useQuery({
        queryKey: ['/api/forum-sentiment-analysis'],
        retry: 1,
        staleTime: 30000
    });
    const { data: nextSteps } = useQuery({
        queryKey: ['/api/next-steps'],
        retry: 1,
        staleTime: 30000
    });
    const { data: totalFunding } = useQuery({
        queryKey: ['/api/contributions/total'],
        retry: 1,
        staleTime: 30000
    });
    // Ensure stats are always valid numbers
    const stats = {
        totalUsers: Number(villageState?.stats?.totalUsers) || 0,
        totalPosts: Number(villageState?.stats?.totalPosts) || 0,
        totalFunding: Number(villageState?.stats?.totalFunding) || 0,
        totalVotes: Number(villageState?.stats?.totalVotes) || 0,
        activeContributors: Number(villageState?.stats?.activeContributors) || 0
    };
    const progressData = [
        { name: "Land Acquisition", progress: 45, color: "holo-gold" },
        { name: "Resource Planning", progress: 78, color: "electric-green" },
        { name: "Community Building", progress: 92, color: "neon-cyan" },
        { name: "Infrastructure Design", progress: 34, color: "electric-green" },
        { name: "Funding Goal", progress: 67, color: "holo-gold" },
    ];
    return (_jsx("div", { className: "min-h-screen p-8 bg-gradient-to-b from-space to-void texture-organic", children: _jsxs("div", { className: "max-w-7xl mx-auto", children: [_jsxs("div", { className: "mb-12", children: [_jsx("h1", { className: "text-4xl font-cyber font-bold text-neon-cyan mb-4", "data-testid": "text-dashboard-title", children: "Village-One Dashboard" }), _jsx("p", { className: "text-xl text-gray-400", children: "Real-time insights into community progress and development" })] }), _jsxs("div", { className: "grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12", children: [_jsxs(Card, { className: "card-rare bg-gradient-to-br from-void to-purple-deep border-holo-gold", children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-300", children: "Total Members" }), _jsx(Users, { className: "text-neon-cyan", size: 20 })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold text-holo-gold", "data-testid": "text-total-members", children: stats.totalUsers.toLocaleString() }), _jsx("p", { className: "text-xs text-gray-400", children: "+12% from last month" })] })] }), _jsxs(Card, { className: "card-epic bg-gradient-to-br from-void to-purple-deep border-purple-500", children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-300", children: "Forum Posts" }), _jsx(MessageSquare, { className: "text-electric-green", size: 20 })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold text-electric-green", "data-testid": "text-total-posts", children: stats.totalPosts.toLocaleString() }), _jsx("p", { className: "text-xs text-gray-400", children: "+8% from last week" })] })] }), _jsxs(Card, { className: "card-legendary bg-gradient-to-br from-void to-purple-deep border-orange-500", children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-300", children: "Total Funding" }), _jsx(DollarSign, { className: "text-holo-gold", size: 20 })] }), _jsxs(CardContent, { children: [_jsxs("div", { className: "text-2xl font-bold text-holo-gold", "data-testid": "text-total-funding", children: ["$", (totalFunding?.total ?? stats.totalFunding).toLocaleString()] }), _jsx("p", { className: "text-xs text-gray-400", children: "67% of goal reached" })] })] }), _jsxs(Card, { className: "card-rare bg-gradient-to-br from-void to-purple-deep border-neon-cyan", children: [_jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-2", children: [_jsx(CardTitle, { className: "text-sm font-medium text-gray-300", children: "Contributors" }), _jsx(TrendingUp, { className: "text-neon-cyan", size: 20 })] }), _jsxs(CardContent, { children: [_jsx("div", { className: "text-2xl font-bold text-neon-cyan", "data-testid": "text-active-contributors", children: stats.activeContributors.toLocaleString() }), _jsx("p", { className: "text-xs text-gray-400", children: "Active this month" })] })] })] }), _jsxs(Card, { className: "card-epic bg-gradient-to-br from-void to-purple-deep mb-12 border-electric-green", children: [_jsx(CardHeader, { children: _jsxs(CardTitle, { className: "flex items-center space-x-3", children: [_jsx(Brain, { className: "text-electric-green", size: 24 }), _jsx("span", { className: "text-electric-green font-cyber", children: "AI Village State Summary" })] }) }), _jsx(CardContent, { children: _jsx("p", { className: "text-gray-300 leading-relaxed", "data-testid": "text-ai-village-summary", children: villageState?.summary ?? "Generating village state analysis..." }) })] }), _jsxs("div", { className: "grid lg:grid-cols-2 gap-8 mb-12", children: [_jsxs(Card, { className: "bg-gradient-to-br from-void to-space border-purple-deep", children: [_jsx(CardHeader, { children: _jsxs(CardTitle, { className: "flex items-center space-x-3", children: [_jsx(Target, { className: "text-neon-cyan", size: 20 }), _jsx("span", { className: "text-neon-cyan font-cyber", children: "Development Milestones" })] }) }), _jsx(CardContent, { className: "space-y-4", children: progressData.map((item, index) => (_jsxs("div", { className: "space-y-2", "data-testid": `milestone-${item.name.toLowerCase().replace(' ', '-')}`, children: [_jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-gray-300", children: item.name }), _jsxs("span", { className: `text-${item.color} font-semibold`, children: [item.progress, "%"] })] }), _jsx(Progress, { value: item.progress, className: "h-2 bg-space" })] }, index))) })] }), _jsxs(Card, { className: "bg-gradient-to-br from-void to-space border-purple-deep", children: [_jsx(CardHeader, { children: _jsxs(CardTitle, { className: "flex items-center space-x-3", children: [_jsx(Brain, { className: "text-holo-gold", size: 20 }), _jsx("span", { className: "text-holo-gold font-cyber", children: "Forum Sentiment Analysis" })] }) }), _jsx(CardContent, { className: "space-y-4", children: Array.isArray(forumSentimentAnalysis) && forumSentimentAnalysis.length > 0 ? forumSentimentAnalysis.map((analysis, index) => (_jsxs("div", { className: "p-3 bg-void rounded-lg border border-gray-800", children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsxs("div", { children: [_jsx("span", { className: "text-gray-300 font-medium capitalize", children: analysis.section }), _jsxs("div", { className: "flex items-center gap-2 mt-1", children: [_jsxs("span", { className: `text-xs capitalize font-semibold ${analysis.priority === 'high' ? 'text-red-400' :
                                                                            analysis.priority === 'medium' ? 'text-yellow-400' :
                                                                                'text-green-400'}`, children: [analysis.priority, " priority"] }), _jsxs("span", { className: "text-xs text-gray-500", children: [analysis.activeThreads, " threads \u2022 ", analysis.engagement, " interactions"] })] })] }), _jsx("span", { className: "text-electric-green capitalize font-semibold", children: analysis.sentiment })] }), _jsx("p", { className: "text-xs text-gray-400", children: analysis.summary })] }, index))) : (_jsx("div", { className: "text-center py-6 text-gray-400", children: "Loading AI sentiment analysis..." })) })] })] }), _jsxs(Card, { className: "card-legendary bg-gradient-to-br from-void to-purple-deep border-orange-500", children: [_jsx(CardHeader, { children: _jsxs(CardTitle, { className: "text-holo-gold font-cyber flex items-center gap-2", children: [_jsx(Target, { className: "w-5 h-5" }), "AI-Generated Next Steps & Priorities"] }) }), _jsx(CardContent, { children: _jsx("div", { className: "grid md:grid-cols-2 lg:grid-cols-3 gap-6", children: Array.isArray(nextSteps) && nextSteps.length > 0 ? nextSteps.map((step, index) => (_jsxs("div", { className: `p-4 rounded-lg border ${step.priority === 'high' ? 'bg-red-950/30 border-red-500/50' :
                                        step.priority === 'medium' ? 'bg-yellow-950/30 border-yellow-500/50' :
                                            'bg-green-950/30 border-green-500/50'}`, "data-testid": `next-step-${index}`, children: [_jsxs("div", { className: "flex items-center justify-between mb-2", children: [_jsx("h4", { className: `font-semibold ${step.priority === 'high' ? 'text-red-400' :
                                                        step.priority === 'medium' ? 'text-yellow-400' :
                                                            'text-green-400'}`, children: step.title }), _jsx("span", { className: `text-xs px-2 py-1 rounded uppercase font-bold ${step.priority === 'high' ? 'bg-red-500/20 text-red-300' :
                                                        step.priority === 'medium' ? 'bg-yellow-500/20 text-yellow-300' :
                                                            'bg-green-500/20 text-green-300'}`, children: step.priority })] }), _jsx("p", { className: "text-sm text-gray-300 mb-2", children: step.description }), _jsxs("div", { className: "text-xs text-gray-400 space-y-1", children: [_jsxs("div", { children: ["Category: ", _jsx("span", { className: "text-gray-300", children: step.category })] }), _jsxs("div", { children: ["Impact: ", _jsx("span", { className: "text-gray-300", children: step.estimatedImpact })] })] })] }, index))) : (_jsxs("div", { className: "col-span-full text-center py-8", children: [_jsx("div", { className: "text-gray-400", children: "Generating AI-powered next steps..." }), _jsx("div", { className: "text-sm text-gray-500 mt-2", children: "Analyzing community activity and priorities" })] })) }) })] })] }) }));
}
